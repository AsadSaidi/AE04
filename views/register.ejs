<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login y Registro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .animated-gradient {
            background: linear-gradient(-45deg, #0ea5e9, #2563eb, #3b82f6, #06b6d4);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }

        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
    </style>
</head>
<body class="animated-gradient min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-5xl">
        <!-- Login & Register Forms -->
        <div id="auth-forms" class="grid md:grid-cols-2 gap-6">
            <!-- Login Form -->
            <div class="glass rounded-3xl p-8 text-white shadow-2xl fade-in">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold mb-2">Iniciar Sesión</h2>
                    <p class="text-white/70">Accede a tu cuenta</p>
                </div>
                
                <form id="login-form" class="space-y-6">
                    <div class="space-y-2">
                        <label for="login-username" class="block text-sm font-medium">Usuario</label>
                        <input type="text" id="login-username" name="username" required
                               class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white/50 transition-all"
                               placeholder="tu_usuario">
                    </div>

                    <div class="space-y-2">
                        <label for="login-password" class="block text-sm font-medium">Contraseña</label>
                        <input type="password" id="login-password" name="password" required
                               class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white/50 transition-all"
                               placeholder="••••••••">
                    </div>

                    <button type="submit"
                            class="w-full bg-white text-blue-600 py-3 px-6 rounded-xl font-semibold hover:bg-white/90 transition-all transform hover:scale-105 shadow-lg">
                        Entrar
                    </button>
                    
                    <span id="login-span" class="block text-center text-sm font-medium h-5"></span>
                </form>
            </div>

            <!-- Register Form -->
            <div class="glass rounded-3xl p-8 text-white shadow-2xl fade-in">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold mb-2">Crear Cuenta</h2>
                    <p class="text-white/70">Regístrate gratis</p>
                </div>
                
                <form id="register-form" class="space-y-6">
                    <div class="space-y-2">
                        <label for="register-username" class="block text-sm font-medium">Usuario</label>
                        <input type="text" id="register-username" name="username" required
                               class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white/50 transition-all"
                               placeholder="tu_usuario">
                    </div>

                    <div class="space-y-2">
                        <label for="register-password" class="block text-sm font-medium">Contraseña</label>
                        <input type="password" id="register-password" name="password" required
                               class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white/50 transition-all"
                               placeholder="••••••••">
                    </div>

                    <div class="space-y-2">
                        <label for="register-confirm-password" class="block text-sm font-medium">Confirmar Contraseña</label>
                        <input type="password" id="register-confirm-password" name="confirm-password" required
                               class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white/50 transition-all"
                               placeholder="••••••••">
                    </div>

                    <button type="submit"
                            class="w-full bg-white text-blue-600 py-3 px-6 rounded-xl font-semibold hover:bg-white/90 transition-all transform hover:scale-105 shadow-lg">
                        Registrarse
                    </button>
                    
                    <span id="register-span" class="block text-center text-sm font-medium h-5"></span>
                </form>
            </div>
        </div>
    </div>

    <script>
        const $ = el => document.querySelector(el);

        const loginForm = $('#login-form');
        const loginSpan = $('#login-span');
        const registerForm = $('#register-form');
        const registerSpan = $('#register-span');

        // LOGIN
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = $('#login-username').value;
            const password = $('#login-password').value;

            const res = await fetch('/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });

            if (res.ok) {
                const data = await res.json();
                localStorage.setItem('token', data.token); // <-- guardar token
                window.location.href = '/protected';
            } else {
                loginSpan.innerText = '✗ Error al iniciar sesión';
                loginSpan.style.color = '#ef4444';
            }
            });


        // REGISTER
        registerForm?.addEventListener('submit', async e => {
            e.preventDefault();
            const username = $('#register-username').value;
            const password = $('#register-password').value;
            const confirmPassword = $('#register-confirm-password').value;

            if (password !== confirmPassword) {
                registerSpan.innerText = '✗ Las contraseñas no coinciden';
                registerSpan.style.color = '#ef4444';
                return;
            }

            try {
                const res = await fetch('/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                const data = await res.json();

                if (res.ok) {
                    registerSpan.innerText = '✓ Usuario registrado... Entrando...';
                    registerSpan.style.color = '#10b981';
                    setTimeout(() => window.location.href = '/protected', 1500);
                } else {
                    registerSpan.innerText = `✗ ${data.error || 'Error al registrar usuario'}`;
                    registerSpan.style.color = '#ef4444';
                }
            } catch (err) {
                registerSpan.innerText = '✗ Error de conexión';
                registerSpan.style.color = '#ef4444';
            }
        });
    </script>
</body>
</html>
